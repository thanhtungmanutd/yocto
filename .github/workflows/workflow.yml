name: Build

on:
  push:
    branches: [ "master" ]

jobs:
  build-yocto:
    runs-on: ubuntu-22.04
    steps:
      - name: clone resource
        run: |
          echo "=== Clone Yocto Layers ==="
          git clone -b kirkstone https://github.com/agherzan/meta-raspberrypi.git
          git clone -b kirkstone https://github.com/yoctoproject/poky.git

      - name: install tools and package
        run: |
          echo "=== Install Dependencies ==="
          sudo apt-get update
          sudo apt-get install -y \
            build-essential chrpath cpio debianutils diffstat file gawk gcc git \
            iputils-ping libacl1 liblz4-tool locales python3 python3-git python3-jinja2 \
            python3-pexpect python3-pip python3-subunit socat texinfo unzip wget \
            xz-utils zstd

      - name: active environment
        run: |
          echo "=== Setup Yocto Build Environment ==="
          cd poky
          source ./oe-init-build-env
          echo ${pwd}

        # bitbake-layers add-layer ../../meta-raspberrypi
        
        # sed -i '/MACHINE ??= "qemux86-64"/s/^/#/' conf/local.conf
        # echo 'MACHINE ?= "raspberrypi4"' >> conf/local.conf

        # bitbake core-image-minimal
